# Replication Package: DeepREST: Automated Test Case Generation for REST APIs Exploiting Deep Reinforcement Learning

This replication package includes:
- a collection of 11 APIs to be tested by automated testing tools (`apis` folder);
- a collection of 6 testing tools, including DeepREST (`tools` folder);
- scripts to build and run the experiment, and to process results (root folder);
- the results presented in the paper (`results` folder);
- the GPT4All implementation to generate realistic input values (`gpt4all` folder).


## Experiment Replication
The experiment requires minimal manual intervention as all tasks are scripted.

### Prerequisites

All APIs and tools will be launched within Docker containers by the Python scripts, so make sure to have Python >= 3.9 and Docker installed on your machine.

We recommend working in a virtual environment and install in it the dependencies in the `requirements.txt` file.

The output data generated by the experiment will take about 500 GB of disk space.

### Duration

The experiment consists of 660 runs (11 APIs * 6 tools * 10 repetitions) of 1 hour that can be parallelized based on the computing power of your system. If you do not parallelize the experiment, it will take up to 1 month to complete!

We recommend running this experiment in a system with adequate resources: 16 cores, 24GB of RAM.

### Configuration
Python scripts supporting multi-threading (`run.py` and `process_results.py`) have a `MULTITHREADING` constant on top that can be set to `False` for sequential execution.

### Running

To run the experiment follow this simple steps.

> LLM dictionaries are already generated and placed in the relevant API folder for a quicker deployment, but they can be re-generated following the instructions in the `gpt4all` folder

1. Build all the docker images for the APIs and tools with the command `python3 build.py` and follow the instructions on the stdout.
    - Docker images will be built in your system. Their name will start with the prefix  `dr-`, such as `dr-deeprest`.
    > The Python APIs for Docker might be slow. Alternatively, you can build all images with the shell script `build.sh`.
2. Run the experiment with the command `python3 run.py` and follow the instructions on the stdout.
    - It will take a lot of time! Each run will create a directory `./results/API/TOOL/RUN` in which there will be log files, a SQLite database with all the recorded HTTP interactions, and the code coverage with samples every 5 seconds.
3. Check the integrity of the executed runs with the command `python3 check.py`.
    - It will check that the runs executed correctly and produced a compliant output. In case some runs failed (Docker is sometimes unstable), you can remove them and relaunch them again.
4. Process results with the command `python3 process_results.py`.
    - It will analyze code coverage files and the HTTP log to produce a summary of each run ('summary.json' in each run directory) and a global summary as CSV in the `./results` directory, similar to what we already provide in this replication package.

## Running DeepREST
If you prefer to run DeepREST on a custom API without executing the entire experiment, please follow these instructions.

You need will a REST API that can be accessed via HTTP, along with its OpenAPI specification. Place the OpenAPI specification in the root folder of the artifact in a directory structure as follows:

`apis/CUSTOM_API/specifications/CUSTOM_API-openapi.json`

For your convenience, we already provide such a directory structure in the artifact so that only the specification file has to be replaced.

Then, build the DeepREST Docker image with the provided script:

`sh build_deeprest.sh`

> Note: If you modify the OpenAPI specification of you custom API, you must re-build the DeepREST Docker image so that the updates specification can be copied into the image!

Finally, run the image with Docker with the provided script:

`sh run_deeprest.sh`

The `run_deeprest.sh` script can be modified to specify the port to which the API responds. The script assumes that the API is running on the local host. If your API is running on a remote host, please update the `tools/deeprest/config.sh` at line 7, replacing `localhost` with the correct hostname, domain, or IP address.

### LLM-based input generator
If you would like to utilize the input generator based on a large language model, you must first create a dictionary of values. This can be accomplished by using the script located in the `gpt4all` folder.

Once the dictionary is generated (in a JSON file), please move it to the directory `apis/CUSTOM_API/dictionaries/CUSTOM_API-llm.json`. After rebuilding the Docker image of DeepREST, it will automatically identify the dictionary and use it during input generation.